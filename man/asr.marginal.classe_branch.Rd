% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/asr.R
\name{asr.marginal.classe_branch}
\alias{asr.marginal.classe_branch}
\title{Ancestral State Reconstruction Along a Branch for ClaSSE/GeoSSE Models}
\usage{
asr.marginal.classe_branch(lik, pars, node.id, relative.t.branch, ...)
}
\arguments{
\item{lik}{A likelihood function created by \code{make.classe.td} or related functions.}

\item{pars}{A vector of parameters suitable for the likelihood function.}

\item{node.id}{The node ID defining the branch of interest (using ape's node indexing,
same as displayed by \code{ape::nodelabels()}).}

\item{relative.t.branch}{The relative time along the branch where reconstruction
should be performed. Time starts from present time (0) and increases as
the branch continues. Can be numeric or "BASE" for the base of the branch (i.e.,
where the focal branch joins with its sister branch).
Must be <= branch length.}

\item{...}{Additional arguments passed through to the reconstruction function,
including root conditions and survival conditioning.}
}
\value{
A column vector containing the marginal probabilities of each character
state at the specified time point along the branch.
}
\description{
Perform marginal ancestral state reconstruction at a specific time point along
a branch for classe models. This function computes the marginal probability of
each state at a given relative time along a specific branch.
}
\details{
This function performs marginal ancestral state reconstruction at a specific
point along a branch, allowing examination of evolutionary transitions within
branches rather than just at nodes. The reconstruction accounts for the
phylogenetic relationships, branch lengths, and time-dependent evolutionary
model specified in the likelihood function.

The function internally converts node IDs from ape's indexing system to
diversitree's indexing system and validates that the requested time point
does not exceed the branch length.
}
\examples{
data(phy5)
cols <- plyr::mapvalues(phy5$tip.state_3, from = c(1:3), to=c('black', "blue","red" ))
plot(phy5, label.offset = 2, cex=1, no.margin = FALSE)
tiplabels(pch = 15, col = cols, cex = 2, adj = 1.5)
nodelabels()
tiplabels()
edgelabels()
axisPhylo()

lik.td <-make.classe.td(phy5, phy5$tip.state_3, k=3, n.epoch=2, control=list(backend = "gslode"),
  strict=TRUE)
par.td <- c(4, c(1:54)/100)
names(par.td) <- diversitree::argnames(lik.td)
lik.est <- lik.td(par.td, intermediates=TRUE)
print(lik.est)

st <-  asr.marginal.classe(lik.td, par.td)
# ASR reconstruction at t=1 along branch 3 (defined by terminal node 9)
# Note: relative.t.branch starts from present time and equals 0 at the branch's start
st9 <-asr.marginal.classe_branch(lik.td, par.td, node.id=9, relative.t.branch= 1 )

print(st)
print(st9)

}
\seealso{
\code{\link{asr.marginal.classe}} for reconstruction at nodes,
\code{\link{make.asr.marginal.classe_branch}} for the function factory version.
}
