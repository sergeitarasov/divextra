% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/asr.R
\name{asr.marginal.classe_branch.multiple}
\alias{asr.marginal.classe_branch.multiple}
\title{Ancestral State Reconstruction Along a Branch at Multiple Time Points}
\usage{
asr.marginal.classe_branch.multiple(
  lik,
  pars,
  node.id,
  Nbins = 1,
  eps = 0.01,
  include.ends = TRUE,
  ...
)
}
\arguments{
\item{lik}{A likelihood function created by \code{make.classe.td} or related functions.}

\item{pars}{A vector of parameters suitable for the likelihood function.}

\item{node.id}{The node ID defining the branch of interest (using ape's node indexing,
same as displayed by \code{ape::nodelabels()}).}

\item{Nbins}{The number of time bins to sample along the branch (default: 1).
More bins provide higher resolution but require more computation.}

\item{eps}{A small epsilon value to avoid sampling exactly at the branch endpoints
(default: 0.01). This prevents numerical issues at boundary conditions.}

\item{include.ends}{Logical indicating whether to include reconstructions at the
exact branch endpoints (present time and base of branch). If TRUE, adds
reconstructions at t=0 and t="BASE" to the results (default: TRUE).}

\item{...}{Additional arguments passed through to the reconstruction function,
including root conditions and survival conditioning.}
}
\value{
A list containing:
\describe{
\item{asr}{A matrix where each column represents a time point and each row
represents a character state. Values are marginal probabilities.}
\item{t}{A vector of time points corresponding to the columns in \code{asr}.}
\item{depth}{The depth (distance from root) of the focal node.}
}
}
\description{
Perform marginal ancestral state reconstruction at multiple time points along
a specific branch for classe models. This function computes the marginal
probability of each state at evenly spaced time intervals along a branch,
providing a detailed view of evolutionary transitions within the branch.
}
\details{
This function extends \code{asr.marginal.classe_branch} to perform reconstructions
at multiple time points along a single branch. Time points are evenly distributed
between \code{eps} and \code{branch_length - eps}. When \code{include.ends=TRUE},
additional reconstructions are added at the exact endpoints.

The function is particularly useful for:
\itemize{
\item Visualizing evolutionary transitions along branches
\item Detecting rapid evolutionary changes within branches
\item Creating detailed plots of state probability changes over time
}

Time measurement follows the same convention as \code{asr.marginal.classe_branch}:
t=0 corresponds to present time (tip), increasing values move toward the ancestral node.
}
\examples{
data(phy5)
cols <- plyr::mapvalues(phy5$tip.state_3, from = c(1:3), to=c('black', "blue","red" ))
plot(phy5, label.offset = 2, cex=1, no.margin = FALSE)
tiplabels(pch = 15, col = cols, cex = 2, adj = 1.5)
nodelabels()
tiplabels()
edgelabels()
axisPhylo()

lik.td <-make.classe.td(phy5, phy5$tip.state_3, k=3, n.epoch=2, control=list(backend = "gslode"),
  strict=TRUE)
par.td <- c(4, c(1:54)/100)
names(par.td) <- diversitree::argnames(lik.td)
lik.est <- lik.td(par.td, intermediates=TRUE)
print(lik.est)

st <-  asr.marginal.classe(lik.td, par.td)
# ASR reconstruction at t=1 along branch 3 (defined by terminal node 9)
# Note: relative.t.branch starts from present time and equals 0 at the branch's start
br9 <- asr.marginal.classe_branch.multiple(lik.td, par.td, node.id=9, Nbins=50, include.ends=TRUE)
plot(br9$t, br9$asr[1,], type='l', xlim=rev(range(br9$t)))

}
\seealso{
\code{\link{asr.marginal.classe_branch}} for single time point reconstruction,
\code{\link{asr.marginal.classe}} for reconstruction at nodes only.
}
